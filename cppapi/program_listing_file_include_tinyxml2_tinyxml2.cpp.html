<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Program Listing for File tinyxml2.cpp &mdash; Intel® GPA Framework  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/gpa.css" type="text/css" />
      <link rel="stylesheet" href="../_static/collapsible-lists\css\tree_view.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/collapsible-lists\js\CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists\js\apply-collapsible-lists.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
     
    <script type="text/javascript">
        //configure tms    
        var wapLocalCode = 'us_en'; //dynamically set per localized site, see mapping table for values
        var wapSection = "gpa-sdk";
        //load tms
        (function() {
            var host = (window.document.location.protocol == 'http:') ? "http://www.intel.com" : "https://www.intel.com";
            var url = host+"/content/dam/www/global/wap/tms-loader.js"; //wap file url
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;  po.src = url;
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

    <form action="https://software.intel.com/en-us/gpa" method="get" target="_blank">
        <button class="download-button" type="submit">Free Download</button>
    </form>
    

          
          
          <a href="../index.html">
            
              <img src="../_static/logo-classicblue-3000px.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../src/getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/getting_started.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/getting_started.html#layer-framework-primer">Layer Framework Primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/getting_started.html#capture-a-stream">Capture a Stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/getting_started.html#play-back-stream">Play Back Stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/getting_started.html#stack-multiple-layers">Stack Multiple Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/getting_started.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src/guides.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/guides/extending_test_layer.html">Extending &quot;Helloworld&quot; Simple Layer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/guides/extending_test_layer.html#layer-anatomy">Layer Anatomy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/guides/extending_test_layer.html#api-call-routing">API Call Routing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src/samples.html">Samples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/samples.html#build-samples">Build Samples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#windows">Windows*</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/samples.html#available-samples">Available Samples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#print-api-log">Print API Log</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#helloworld-simple-layer">'Helloworld' Simple Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#helloworld-generated-layer">'Helloworld' Generated Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#range-player">Range Player</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#buffer-extractor">Buffer Extractor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#texture-extraction">Texture Extraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#sampler-extractor">Sampler Extractor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#shader-extractor">Shader Extractor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#disable-call-in-range">Disable Call in Range</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#metrics-collection">Metrics Collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#highlighting-experiment">Highlighting Experiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#pipeline-experiment">Pipeline Experiment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#texture-replacement-experiments">Texture Replacement Experiments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#advanced-stream-playback">Advanced Stream Playback</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/samples.html#stream-filter">Stream Filter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src/reference.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/utilities.html">Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/utilities.html#gpa-injector">gpa-injector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/utilities.html#gpa-player">gpa-player</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/utilities.html#gpa-subcapture-recorder">gpa-subcapture-recorder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/utilities.html#gpa-stream-info">gpa-stream-info</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/utilities.html#gpa-stream-analyzer">gpa-stream-analyzer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/utilities.html#gpa-cpp-generator">gpa-cpp-generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/utilities.html#gpa-help">gpa-help</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/utilities.html#gpa-metrics-collector">gpa-metrics-collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/utilities.html#gpa-system-info">gpa-system-info</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/layers.html">Layers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/layers.html#capture">capture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/layers.html#screenshot">screenshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/layers.html#hud-layer">hud-layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/layers.html#logging">logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/layers.html#api-debug-layer">api-debug-layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/layers.html#device-override">device-override</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/layers.html#dump-resources-layer">dump-resources-layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/layers.html#dump-state-layer">dump-state-layer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/python.html">Python Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="library_root.html">C++ Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="library_root.html#page-hierarchy">Page Hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="library_root.html#class-hierarchy">Class Hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="library_root.html#file-hierarchy">File Hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="library_root.html#full-api">Full API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="library_root.html#namespaces">Namespaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="library_root.html#classes-and-structs">Classes and Structs</a></li>
<li class="toctree-l4"><a class="reference internal" href="library_root.html#enums">Enums</a></li>
<li class="toctree-l4"><a class="reference internal" href="library_root.html#unions">Unions</a></li>
<li class="toctree-l4"><a class="reference internal" href="library_root.html#functions">Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="library_root.html#variables">Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="library_root.html#defines">Defines</a></li>
<li class="toctree-l4"><a class="reference internal" href="library_root.html#typedefs">Typedefs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src/features.html">Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/features.html#capture-and-playback">Capture and Playback</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#basic-capture-and-playback">Basic Capture and Playback</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#keyframing-capture">Keyframing Capture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#deferred-capture">Deferred Capture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#range-repeat">Range Repeat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#subcapture">Subcapture</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/features.html#stream-analysis">Stream Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#metric-collection">Metric Collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#experiments">Experiments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#metadata-extraction">Metadata Extraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#resource-extraction">Resource Extraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#api-call-inspection">API Call Inspection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/features.html#layers">Layers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#heads-up-display-hud-layer">Heads-Up Display(HUD) Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#screenshot-layer">Screenshot Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#logging-layer">Logging Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#api-debug-layer">Api Debug Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#device-override-layer">Device Override Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/features.html#custom-user-layers">Custom (User) Layers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src/requirements.html">System Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/requirements.html#hardware-requirements">Hardware Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/requirements.html#software-requirements">Software Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/requirements.html#supported-graphics-apis">Supported Graphics APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src/release_notes.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#dec-14-2023">2023.4 (Dec 14 2023)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#new">NEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#changed">CHANGED</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#fixed">FIXED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#sept-21-2023">2023.3 (Sept 21 2023)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id2">NEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id3">CHANGED</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id4">FIXED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#june-2023">2023.2 (15 June 2023)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id5">NEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id6">CHANGED</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id7">FIXED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#march-2023">2023.1 (15 March 2023)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id8">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id9">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id10">Fixed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#december-2022">2022.4 (15 December 2022)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id11">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id12">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id13">Fixed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#deprecated">Deprecated</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#september-2022">2022.3 (15 September 2022)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id14">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id15">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id16">Fixed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#june-2022">2022.2 (30 June 2022)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id17">New</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#march-2022">2022.1 (16 March 2022)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id18">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id19">Fixed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id20">Changed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#december-2021">2021.4 (16 December 2021)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id21">New</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id22">Fixed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id23">Deprecated</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#september-2021">2021.3 (23 September 2021)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id24">NEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id25">CHANGED</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id26">FIXED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#june-2021">2021.2 (24 June 2021)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id27">NEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id28">CHANGED</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id29">FIXED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#march-2021">2021.1 (24 March 2021)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id30">NEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id31">CHANGED</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id32">FIXED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#january-2021">2020.4.1 (21 January 2021)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id33">NEW</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#december-2020">2020.4 (14 December 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id34">NEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id35">CHANGED</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id36">FIXED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#september-2020">2020.3 (24 September 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id37">NEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id38">CHANGED</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id39">FIXED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#june-2020">2020.2 (25 June 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id40">NEW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id43">CHANGED</a></li>
<li class="toctree-l3"><a class="reference internal" href="../src/release_notes.html#id44">FIXED</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#march-2020">2020.1 (26 March 2020)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#december-2019">2019.4 (19 December 2019)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#september-2019">2019.3 (26 September 2019)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/release_notes.html#june-2019">2019.2 (27 June 2019)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src/troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#known-issues-and-limitations">Known Issues and Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id2">2023.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id7">2023.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id10">2023.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id13">2023.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id16">2022.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id17">2022.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id18">2022.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id19">2022.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id20">2021.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id21">2021.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id22">2021.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id23">2020.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src/troubleshooting.html#id24">2019.2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src/licenses.html">Legal Information</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../src/licenses.html#third-party-content">Third Party Content</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../src/disclaimer.html">Notices &amp; Disclaimers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Intel® GPA Framework</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Program Listing for File tinyxml2.cpp</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="program-listing-for-file-tinyxml2-cpp">
<span id="program-listing-file-include-tinyxml2-tinyxml2-cpp"></span><h1>Program Listing for File tinyxml2.cpp<a class="headerlink" href="#program-listing-for-file-tinyxml2-cpp" title="Permalink to this headline"></a></h1>
<p>↰ <a class="reference internal" href="file_include_tinyxml2_tinyxml2.cpp.html#file-include-tinyxml2-tinyxml2-cpp"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">include\tinyxml2\tinyxml2.cpp</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">Original code by Lee Thomason (www.grinninglizard.com)</span>

<span class="cm">This software is provided &#39;as-is&#39;, without any express or implied</span>
<span class="cm">warranty. In no event will the authors be held liable for any</span>
<span class="cm">damages arising from the use of this software.</span>

<span class="cm">Permission is granted to anyone to use this software for any</span>
<span class="cm">purpose, including commercial applications, and to alter it and</span>
<span class="cm">redistribute it freely, subject to the following restrictions:</span>

<span class="cm">1. The origin of this software must not be misrepresented; you must</span>
<span class="cm">not claim that you wrote the original software. If you use this</span>
<span class="cm">software in a product, an acknowledgment in the product documentation</span>
<span class="cm">would be appreciated but is not required.</span>

<span class="cm">2. Altered source versions must be plainly marked as such, and</span>
<span class="cm">must not be misrepresented as being the original software.</span>

<span class="cm">3. This notice may not be removed or altered from any source</span>
<span class="cm">distribution.</span>
<span class="cm">*/</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tinyxml2.h&quot;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;new&gt;</span><span class="c1">      // yes, this one new style header, is in the Android SDK.</span>
<span class="cp">#if defined(ANDROID_NDK) || defined(__BORLANDC__) || defined(__QNXNTO__)</span>
<span class="cp">#</span><span class="w">   </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;stddef.h&gt;</span>
<span class="cp">#</span><span class="w">   </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;stdarg.h&gt;</span>
<span class="cp">#else</span>
<span class="cp">#</span><span class="w">   </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;cstddef&gt;</span>
<span class="cp">#</span><span class="w">   </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;cstdarg&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1400 ) &amp;&amp; (!defined WINCE)</span>
<span class="w">    </span><span class="c1">// Microsoft Visual Studio, version 2005 and higher. Not WinCE.</span>
<span class="w">    </span><span class="cm">/*int _snprintf_s(</span>
<span class="cm">       char *buffer,</span>
<span class="cm">       size_t sizeOfBuffer,</span>
<span class="cm">       size_t count,</span>
<span class="cm">       const char *format [,</span>
<span class="cm">          argument] ...</span>
<span class="cm">    );*/</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">TIXML_SNPRINTF</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">va_list</span><span class="w"> </span><span class="n">va</span><span class="p">;</span>
<span class="w">        </span><span class="n">va_start</span><span class="p">(</span><span class="w"> </span><span class="n">va</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vsnprintf_s</span><span class="p">(</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">_TRUNCATE</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">va_end</span><span class="p">(</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">TIXML_VSNPRINTF</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="kt">va_list</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vsnprintf_s</span><span class="p">(</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">_TRUNCATE</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cp">#define TIXML_VSCPRINTF _vscprintf</span>
<span class="w">    </span><span class="cp">#define TIXML_SSCANF    sscanf_s</span>
<span class="cp">#elif defined _MSC_VER</span>
<span class="w">    </span><span class="c1">// Microsoft Visual Studio 2003 and earlier or WinCE</span>
<span class="w">    </span><span class="cp">#define TIXML_SNPRINTF  _snprintf</span>
<span class="w">    </span><span class="cp">#define TIXML_VSNPRINTF _vsnprintf</span>
<span class="w">    </span><span class="cp">#define TIXML_SSCANF    sscanf</span>
<span class="w">    </span><span class="cp">#if (_MSC_VER &lt; 1400 ) &amp;&amp; (!defined WINCE)</span>
<span class="w">        </span><span class="c1">// Microsoft Visual Studio 2003 and not WinCE.</span>
<span class="w">        </span><span class="cp">#define TIXML_VSCPRINTF   _vscprintf </span><span class="c1">// VS2003&#39;s C runtime has this, but VC6 C runtime or WinCE SDK doesn&#39;t have.</span>
<span class="w">    </span><span class="cp">#else</span>
<span class="w">        </span><span class="c1">// Microsoft Visual Studio 2003 and earlier or WinCE.</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">TIXML_VSCPRINTF</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="kt">va_list</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">512</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
<span class="w">                </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="p">]();</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_vsnprintf</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">va</span><span class="p">);</span>
<span class="w">                </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">str</span><span class="p">;</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">required</span><span class="p">;</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="cp">#endif</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="c1">// GCC version 3 and higher</span>
<span class="w">    </span><span class="c1">//#warning( &quot;Using sn* functions.&quot; )</span>
<span class="w">    </span><span class="cp">#define TIXML_SNPRINTF  snprintf</span>
<span class="w">    </span><span class="cp">#define TIXML_VSNPRINTF vsnprintf</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">TIXML_VSCPRINTF</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="kt">va_list</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vsnprintf</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="cp">#define TIXML_SSCANF   sscanf</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(_WIN64)</span>
<span class="w">    </span><span class="cp">#define TIXML_FSEEK _fseeki64</span>
<span class="w">    </span><span class="cp">#define TIXML_FTELL _ftelli64</span>
<span class="cp">#elif defined(__APPLE__) || defined(__FreeBSD__) || defined(__ANDROID__)</span>
<span class="w">    </span><span class="cp">#define TIXML_FSEEK fseeko</span>
<span class="w">    </span><span class="cp">#define TIXML_FTELL ftello</span>
<span class="cp">#elif defined(__unix__) &amp;&amp; defined(__x86_64__)</span>
<span class="w">    </span><span class="cp">#define TIXML_FSEEK fseeko64</span>
<span class="w">    </span><span class="cp">#define TIXML_FTELL ftello64</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="cp">#define TIXML_FSEEK fseek</span>
<span class="w">    </span><span class="cp">#define TIXML_FTELL ftell</span>
<span class="cp">#endif</span>


<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">LINE_FEED</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">);</span><span class="w">          </span><span class="c1">// all line endings are normalized to LF</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">LF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LINE_FEED</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">CARRIAGE_RETURN</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="mh">0x0d</span><span class="p">);</span><span class="w">          </span><span class="c1">// CR gets filtered out</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">CR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CARRIAGE_RETURN</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">SINGLE_QUOTE</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">DOUBLE_QUOTE</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\&quot;&#39;</span><span class="p">;</span>

<span class="c1">// Bunch of unicode info at:</span>
<span class="c1">//      http://www.unicode.org/faq/utf_bom.html</span>
<span class="c1">//  ef bb bf (Microsoft &quot;lead bytes&quot;) - designates UTF-8</span>

<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">TIXML_UTF_LEAD_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xefU</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">TIXML_UTF_LEAD_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xbbU</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">TIXML_UTF_LEAD_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xbfU</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">tinyxml2</span>
<span class="p">{</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Entity</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pattern</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NUM_ENTITIES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Entity</span><span class="w"> </span><span class="n">entities</span><span class="p">[</span><span class="n">NUM_ENTITIES</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;quot&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">    </span><span class="n">DOUBLE_QUOTE</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;amp&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">     </span><span class="sc">&#39;&amp;&#39;</span><span class="w">  </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;apos&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">    </span><span class="n">SINGLE_QUOTE</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;lt&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">      </span><span class="sc">&#39;&lt;&#39;</span><span class="w">  </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;gt&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">      </span><span class="sc">&#39;&gt;&#39;</span><span class="w">  </span><span class="p">}</span>
<span class="p">};</span>


<span class="n">StrPair</span><span class="o">::~</span><span class="n">StrPair</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Reset</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">TransferTo</span><span class="p">(</span><span class="w"> </span><span class="n">StrPair</span><span class="o">*</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// This in effect implements the assignment operator by &quot;moving&quot;</span>
<span class="w">    </span><span class="c1">// ownership (as in auto_ptr).</span>

<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">other</span><span class="o">-&gt;</span><span class="n">_flags</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">other</span><span class="o">-&gt;</span><span class="n">_start</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">other</span><span class="o">-&gt;</span><span class="n">_end</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="n">other</span><span class="o">-&gt;</span><span class="n">Reset</span><span class="p">();</span>

<span class="w">    </span><span class="n">other</span><span class="o">-&gt;</span><span class="n">_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_flags</span><span class="p">;</span>
<span class="w">    </span><span class="n">other</span><span class="o">-&gt;</span><span class="n">_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_start</span><span class="p">;</span>
<span class="w">    </span><span class="n">other</span><span class="o">-&gt;</span><span class="n">_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_end</span><span class="p">;</span>

<span class="w">    </span><span class="n">_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">Reset</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NEEDS_DELETE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="n">_start</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">SetStr</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Reset</span><span class="p">();</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_start</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="w"> </span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">];</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="w"> </span><span class="n">_start</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
<span class="w">    </span><span class="n">_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NEEDS_DELETE</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">ParseText</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">endTag</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">strFlags</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">endTag</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">endTag</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">curLineNumPtr</span><span class="p">);</span>

<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w">  </span><span class="n">endChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">endTag</span><span class="p">;</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="w"> </span><span class="n">endTag</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Inner loop of text parsing.</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">endChar</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">strncmp</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">endTag</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Set</span><span class="p">(</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">strFlags</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">++</span><span class="p">(</span><span class="o">*</span><span class="n">curLineNumPtr</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">ParseName</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">p</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">IsNameStartChar</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">IsNameChar</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">Set</span><span class="p">(</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">CollapseWhitespace</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Adjusting _start would cause undefined behavior on delete[]</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NEEDS_DELETE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Trim leading space.</span>
<span class="w">    </span><span class="n">_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">SkipWhiteSpace</span><span class="p">(</span><span class="w"> </span><span class="n">_start</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">_start</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_start</span><span class="p">;</span><span class="w"> </span><span class="c1">// the read pointer</span>
<span class="w">        </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_start</span><span class="p">;</span><span class="w">   </span><span class="c1">// the write pointer</span>

<span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">IsWhiteSpace</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">SkipWhiteSpace</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w">    </span><span class="c1">// don&#39;t write to q; this trims the trailing space.</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">;</span>
<span class="w">                </span><span class="o">++</span><span class="n">q</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
<span class="w">            </span><span class="o">++</span><span class="n">q</span><span class="p">;</span>
<span class="w">            </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">GetStr</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_start</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_end</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NEEDS_FLUSH</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">_flags</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">NEEDS_FLUSH</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_flags</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_start</span><span class="p">;</span><span class="w"> </span><span class="c1">// the read pointer</span>
<span class="w">            </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_start</span><span class="p">;</span><span class="w">   </span><span class="c1">// the write pointer</span>

<span class="w">            </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_end</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NEEDS_NEWLINE_NORMALIZATION</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CR</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// CR-LF pair becomes LF</span>
<span class="w">                    </span><span class="c1">// CR alone becomes LF</span>
<span class="w">                    </span><span class="c1">// LF-CR becomes LF</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">LF</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LF</span><span class="p">;</span>
<span class="w">                    </span><span class="o">++</span><span class="n">q</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NEEDS_NEWLINE_NORMALIZATION</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">LF</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">CR</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LF</span><span class="p">;</span>
<span class="w">                    </span><span class="o">++</span><span class="n">q</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NEEDS_ENTITY_PROCESSING</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;&amp;&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Entities handled by tinyXML2:</span>
<span class="w">                    </span><span class="c1">// - special entities in the entity table [in/out]</span>
<span class="w">                    </span><span class="c1">// - numeric character reference [in]</span>
<span class="w">                    </span><span class="c1">//   &amp;#20013; or &amp;#x4e2d;</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;#&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">buflen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">                        </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">buflen</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="w">                        </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">adjusted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">GetCharacterRef</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">len</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">adjusted</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
<span class="w">                            </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">                            </span><span class="o">++</span><span class="n">q</span><span class="p">;</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">buflen</span><span class="w"> </span><span class="p">);</span>
<span class="w">                            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">adjusted</span><span class="w"> </span><span class="p">);</span>
<span class="w">                            </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">adjusted</span><span class="p">;</span>
<span class="w">                            </span><span class="n">memcpy</span><span class="p">(</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="p">);</span>
<span class="w">                            </span><span class="n">q</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kt">bool</span><span class="w"> </span><span class="n">entityFound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                        </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">NUM_ENTITIES</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="k">const</span><span class="w"> </span><span class="n">Entity</span><span class="o">&amp;</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">                            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">strncmp</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                                    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="c1">// Found an entity - convert.</span>
<span class="w">                                </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
<span class="w">                                </span><span class="o">++</span><span class="n">q</span><span class="p">;</span>
<span class="w">                                </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">                                </span><span class="n">entityFound</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                                </span><span class="k">break</span><span class="p">;</span>
<span class="w">                            </span><span class="p">}</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">entityFound</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="c1">// fixme: treat as error?</span>
<span class="w">                            </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">                            </span><span class="o">++</span><span class="n">q</span><span class="p">;</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
<span class="w">                    </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">                    </span><span class="o">++</span><span class="n">q</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// The loop below has plenty going on, and this</span>
<span class="w">        </span><span class="c1">// is a less useful mode. Break it out.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NEEDS_WHITESPACE_COLLAPSING</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">CollapseWhitespace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NEEDS_DELETE</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_start</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_start</span><span class="p">;</span>
<span class="p">}</span>




<span class="c1">// --------- XMLUtil ----------- //</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">writeBoolTrue</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">writeBoolFalse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">XMLUtil::SetBoolSerialization</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">writeTrue</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">writeFalse</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">defTrue</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">defFalse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="n">writeBoolTrue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">writeTrue</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">writeTrue</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">defTrue</span><span class="p">;</span>
<span class="w">    </span><span class="n">writeBoolFalse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">writeFalse</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">writeFalse</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">defFalse</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">XMLUtil::ReadBOM</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">bom</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">bom</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="o">*</span><span class="n">bom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Check for BOM:</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w">    </span><span class="o">*</span><span class="p">(</span><span class="n">pu</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TIXML_UTF_LEAD_0</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">pu</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TIXML_UTF_LEAD_1</span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">pu</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TIXML_UTF_LEAD_2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">bom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">XMLUtil::ConvertUTF32ToUTF8</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">BYTE_MASK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xBF</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">BYTE_MARK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x80</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">FIRST_BYTE_MARK</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0xC0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xE0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xF8</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFC</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">0x80</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">0x800</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">0x10000</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">0x200000</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">    </span><span class="c1">// This code won&#39;t convert this correctly anyway.</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">*</span><span class="n">length</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Scary scary fall throughs are annotated with carefully designed comments</span>
<span class="w">    </span><span class="c1">// to suppress compiler warnings such as -Wimplicit-fallthrough in gcc</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span>
<span class="w">            </span><span class="o">--</span><span class="n">output</span><span class="p">;</span>
<span class="w">            </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">((</span><span class="n">input</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BYTE_MARK</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">BYTE_MASK</span><span class="p">);</span>
<span class="w">            </span><span class="n">input</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">            </span><span class="c1">//fall through</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span>
<span class="w">            </span><span class="o">--</span><span class="n">output</span><span class="p">;</span>
<span class="w">            </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">((</span><span class="n">input</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BYTE_MARK</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">BYTE_MASK</span><span class="p">);</span>
<span class="w">            </span><span class="n">input</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">            </span><span class="c1">//fall through</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<span class="w">            </span><span class="o">--</span><span class="n">output</span><span class="p">;</span>
<span class="w">            </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">((</span><span class="n">input</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BYTE_MARK</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">BYTE_MASK</span><span class="p">);</span>
<span class="w">            </span><span class="n">input</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="w">            </span><span class="c1">//fall through</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">            </span><span class="o">--</span><span class="n">output</span><span class="p">;</span>
<span class="w">            </span><span class="o">*</span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">FIRST_BYTE_MARK</span><span class="p">[</span><span class="o">*</span><span class="n">length</span><span class="p">]);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">XMLUtil::GetCharacterRef</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Presume an entity, and pull it out.</span>
<span class="w">    </span><span class="o">*</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;#&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">ucs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">ucs</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="kt">ptrdiff_t</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">mult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">SEMICOLON</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;x&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Hexadecimal.</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">+</span><span class="mi">3</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strchr</span><span class="p">(</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">SEMICOLON</span><span class="w"> </span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SEMICOLON</span><span class="w"> </span><span class="p">);</span>

<span class="w">            </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="o">-</span><span class="n">p</span><span class="p">;</span>
<span class="w">            </span><span class="o">--</span><span class="n">q</span><span class="p">;</span>

<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;x&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;f&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;F&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">digit</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">digit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mult</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">UINT_MAX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">digit</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">digitScaled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mult</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">digit</span><span class="p">;</span>
<span class="w">                </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">ucs</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">ULONG_MAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">digitScaled</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="n">ucs</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">digitScaled</span><span class="p">;</span>
<span class="w">                </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">mult</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">UINT_MAX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="n">mult</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<span class="w">                </span><span class="o">--</span><span class="n">q</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Decimal.</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strchr</span><span class="p">(</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">SEMICOLON</span><span class="w"> </span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SEMICOLON</span><span class="w"> </span><span class="p">);</span>

<span class="w">            </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="o">-</span><span class="n">p</span><span class="p">;</span>
<span class="w">            </span><span class="o">--</span><span class="n">q</span><span class="p">;</span>

<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;#&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="sc">&#39;9&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">                    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">digit</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">digit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mult</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">UINT_MAX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">digit</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">digitScaled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mult</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">digit</span><span class="p">;</span>
<span class="w">                    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">ucs</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">ULONG_MAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">digitScaled</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="n">ucs</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">digitScaled</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">mult</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">UINT_MAX</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="n">mult</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">                </span><span class="o">--</span><span class="n">q</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// convert the UCS to UTF-8</span>
<span class="w">        </span><span class="n">ConvertUTF32ToUTF8</span><span class="p">(</span><span class="w"> </span><span class="n">ucs</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">XMLUtil::ToStr</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bufferSize</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXML_SNPRINTF</span><span class="p">(</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">bufferSize</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">XMLUtil::ToStr</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bufferSize</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXML_SNPRINTF</span><span class="p">(</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">bufferSize</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%u&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">XMLUtil::ToStr</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bufferSize</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXML_SNPRINTF</span><span class="p">(</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">bufferSize</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">writeBoolTrue</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">writeBoolFalse</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">    ToStr() of a number is a very tricky topic.</span>
<span class="cm">    https://github.com/leethomason/tinyxml2/issues/106</span>
<span class="cm">*/</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">XMLUtil::ToStr</span><span class="p">(</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bufferSize</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXML_SNPRINTF</span><span class="p">(</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">bufferSize</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%.8g&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">XMLUtil::ToStr</span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bufferSize</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXML_SNPRINTF</span><span class="p">(</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">bufferSize</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%.17g&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="nf">XMLUtil::ToStr</span><span class="p">(</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bufferSize</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// horrible syntax trick to make the compiler happy about %lld</span>
<span class="w">    </span><span class="n">TIXML_SNPRINTF</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">bufferSize</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lld&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">XMLUtil::ToStr</span><span class="p">(</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">bufferSize</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// horrible syntax trick to make the compiler happy about %llu</span>
<span class="w">    </span><span class="n">TIXML_SNPRINTF</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">bufferSize</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%llu&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">XMLUtil::ToInt</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsPrefixHex</span><span class="p">(</span><span class="n">str</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TIXML_SSCANF</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%x&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TIXML_SSCANF</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">XMLUtil::ToUnsigned</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TIXML_SSCANF</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">IsPrefixHex</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;%x&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;%u&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">XMLUtil::ToBool</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ival</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ToInt</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ival</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ival</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">TRUE_VALS</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;True&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TRUE&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">FALSE_VALS</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;False&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FALSE&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">TRUE_VALS</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringEqual</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">TRUE_VALS</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">FALSE_VALS</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringEqual</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">FALSE_VALS</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="nf">XMLUtil::ToFloat</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">TIXML_SSCANF</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="nf">XMLUtil::ToDouble</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">TIXML_SSCANF</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lf&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="nf">XMLUtil::ToInt64</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsPrefixHex</span><span class="p">(</span><span class="n">str</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">   </span><span class="c1">// horrible syntax trick to make the compiler happy about %llx</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TIXML_SSCANF</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%llx&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">    </span><span class="c1">// horrible syntax trick to make the compiler happy about %lld</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TIXML_SSCANF</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lld&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="nf">XMLUtil::ToUnsigned64</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">   </span><span class="c1">// horrible syntax trick to make the compiler happy about %llu</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">TIXML_SSCANF</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">IsPrefixHex</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;%llx&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;%llu&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span><span class="n">v</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="nf">XMLDocument::Identify</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">**</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">startLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_parseCurLineNum</span><span class="p">;</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">SkipWhiteSpace</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_parseCurLineNum</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// These strings define the matching patterns:</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">xmlHeader</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;&lt;?&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">commentHeader</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;&lt;!--&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">cdataHeader</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;&lt;![CDATA[&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">dtdHeader</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;&lt;!&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">elementHeader</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;&lt;&quot;</span><span class="w"> </span><span class="p">};</span><span class="w">  </span><span class="c1">// and a header for everything else; check last.</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">xmlHeaderLen</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">commentHeaderLen</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cdataHeaderLen</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dtdHeaderLen</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">elementHeaderLen</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">XMLComment</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">XMLUnknown</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w">        </span><span class="c1">// use same memory pool</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">XMLComment</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDeclaration</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w">    </span><span class="c1">// use same memory pool</span>
<span class="w">    </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">returnNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">xmlHeader</span><span class="p">,</span><span class="w"> </span><span class="n">xmlHeaderLen</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">returnNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLDeclaration</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_commentPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">returnNode</span><span class="o">-&gt;</span><span class="n">_parseLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_parseCurLineNum</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">xmlHeaderLen</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">commentHeader</span><span class="p">,</span><span class="w"> </span><span class="n">commentHeaderLen</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">returnNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLComment</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_commentPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">returnNode</span><span class="o">-&gt;</span><span class="n">_parseLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_parseCurLineNum</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">commentHeaderLen</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">cdataHeader</span><span class="p">,</span><span class="w"> </span><span class="n">cdataHeaderLen</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XMLText</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLText</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_textPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">returnNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>
<span class="w">        </span><span class="n">returnNode</span><span class="o">-&gt;</span><span class="n">_parseLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_parseCurLineNum</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">cdataHeaderLen</span><span class="p">;</span>
<span class="w">        </span><span class="n">text</span><span class="o">-&gt;</span><span class="n">SetCData</span><span class="p">(</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">dtdHeader</span><span class="p">,</span><span class="w"> </span><span class="n">dtdHeaderLen</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">returnNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLUnknown</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_commentPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">returnNode</span><span class="o">-&gt;</span><span class="n">_parseLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_parseCurLineNum</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">dtdHeaderLen</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">elementHeader</span><span class="p">,</span><span class="w"> </span><span class="n">elementHeaderLen</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">returnNode</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLElement</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_elementPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">returnNode</span><span class="o">-&gt;</span><span class="n">_parseLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_parseCurLineNum</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">elementHeaderLen</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">returnNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLText</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_textPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">returnNode</span><span class="o">-&gt;</span><span class="n">_parseLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_parseCurLineNum</span><span class="p">;</span><span class="w"> </span><span class="c1">// Report line of first non-whitespace character</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">;</span><span class="w">  </span><span class="c1">// Back it up, all the text counts.</span>
<span class="w">        </span><span class="n">_parseCurLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startLine</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">returnNode</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="o">*</span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">returnNode</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="nf">XMLDocument::Accept</span><span class="p">(</span><span class="w"> </span><span class="n">XMLVisitor</span><span class="o">*</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="o">-&gt;</span><span class="n">VisitEnter</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="o">=</span><span class="n">FirstChild</span><span class="p">();</span><span class="w"> </span><span class="n">node</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">NextSibling</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">Accept</span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">visitor</span><span class="o">-&gt;</span><span class="n">VisitExit</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// --------- XMLNode ----------- //</span>

<span class="n">XMLNode</span><span class="o">::</span><span class="n">XMLNode</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<span class="w">    </span><span class="n">_document</span><span class="p">(</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_parent</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_value</span><span class="p">(),</span>
<span class="w">    </span><span class="n">_parseLineNum</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_firstChild</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">_lastChild</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_prev</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">_next</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_userData</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_memPool</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>


<span class="n">XMLNode</span><span class="o">::~</span><span class="n">XMLNode</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">DeleteChildren</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_parent</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_parent</span><span class="o">-&gt;</span><span class="n">Unlink</span><span class="p">(</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Edge case: XMLDocuments don&#39;t have a Value. Return null.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">ToDocument</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">GetStr</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">SetValue</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">staticMem</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">staticMem</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_value</span><span class="p">.</span><span class="n">SetInternedStr</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_value</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">DeepClone</span><span class="p">(</span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">ShallowClone</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">clone</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">FirstChild</span><span class="p">();</span><span class="w"> </span><span class="n">child</span><span class="p">;</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">NextSibling</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">childClone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">DeepClone</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">childClone</span><span class="p">);</span>
<span class="w">        </span><span class="n">clone</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span><span class="n">childClone</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">clone</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">DeleteChildren</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">_firstChild</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_lastChild</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">DeleteChild</span><span class="p">(</span><span class="w"> </span><span class="n">_firstChild</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">_firstChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_lastChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">Unlink</span><span class="p">(</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_document</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_document</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_firstChild</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_firstChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_firstChild</span><span class="o">-&gt;</span><span class="n">_next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_lastChild</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_lastChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_lastChild</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_next</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">DeleteChild</span><span class="p">(</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_document</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_document</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Unlink</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">DeleteNode</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">InsertEndChild</span><span class="p">(</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_document</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">_document</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">InsertChildPreamble</span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_lastChild</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_firstChild</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_lastChild</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">_lastChild</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>
<span class="w">        </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_lastChild</span><span class="p">;</span>
<span class="w">        </span><span class="n">_lastChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>

<span class="w">        </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_firstChild</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">_firstChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_lastChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>

<span class="w">        </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">InsertFirstChild</span><span class="p">(</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_document</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">_document</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">InsertChildPreamble</span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_firstChild</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_lastChild</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_firstChild</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>

<span class="w">        </span><span class="n">_firstChild</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>
<span class="w">        </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_firstChild</span><span class="p">;</span>
<span class="w">        </span><span class="n">_firstChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>

<span class="w">        </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_lastChild</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">_firstChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_lastChild</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>

<span class="w">        </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">InsertAfterChild</span><span class="p">(</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">afterThis</span><span class="p">,</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_document</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">_document</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">afterThis</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">afterThis</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">afterThis</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Current state: BeforeThis -&gt; AddThis -&gt; OneAfterAddThis</span>
<span class="w">        </span><span class="c1">// Now AddThis must disappear from it&#39;s location and then</span>
<span class="w">        </span><span class="c1">// reappear between BeforeThis and OneAfterAddThis.</span>
<span class="w">        </span><span class="c1">// So just leave it where it is.</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">afterThis</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// The last node or the only node.</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">InsertEndChild</span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">InsertChildPreamble</span><span class="p">(</span><span class="w"> </span><span class="n">addThis</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">afterThis</span><span class="p">;</span>
<span class="w">    </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">afterThis</span><span class="o">-&gt;</span><span class="n">_next</span><span class="p">;</span>
<span class="w">    </span><span class="n">afterThis</span><span class="o">-&gt;</span><span class="n">_next</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>
<span class="w">    </span><span class="n">afterThis</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>
<span class="w">    </span><span class="n">addThis</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">addThis</span><span class="p">;</span>
<span class="p">}</span>




<span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">FirstChildElement</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_firstChild</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ToElementWithName</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">LastChildElement</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_lastChild</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ToElementWithName</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">NextSiblingElement</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_next</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ToElementWithName</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">PreviousSiblingElement</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_prev</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_prev</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ToElementWithName</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">*</span><span class="w"> </span><span class="n">parentEndTag</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// This is a recursive method, but thinking about it &quot;at the current level&quot;</span>
<span class="w">    </span><span class="c1">// it is a pretty simple flat list:</span>
<span class="w">    </span><span class="c1">//      &lt;foo/&gt;</span>
<span class="w">    </span><span class="c1">//      &lt;!-- comment --&gt;</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// With a special case:</span>
<span class="w">    </span><span class="c1">//      &lt;foo&gt;</span>
<span class="w">    </span><span class="c1">//      &lt;/foo&gt;</span>
<span class="w">    </span><span class="c1">//      &lt;!-- comment --&gt;</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// Where the closing element (/foo) *must* be the next thing after the opening</span>
<span class="w">    </span><span class="c1">// element, and the names must match. BUT the tricky bit is that the closing</span>
<span class="w">    </span><span class="c1">// element will be read by the child.</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// &#39;endTag&#39; is the end tag for this node, it is returned by a call to a child.</span>
<span class="w">    </span><span class="c1">// &#39;parentEnd&#39; is the end tag for the parent, which is filled in and returned.</span>

<span class="w">    </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">DepthTracker</span><span class="w"> </span><span class="nf">tracker</span><span class="p">(</span><span class="n">_document</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">Error</span><span class="p">())</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">Identify</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">       </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">initialLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_parseLineNum</span><span class="p">;</span>

<span class="w">        </span><span class="n">StrPair</span><span class="w"> </span><span class="n">endTag</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">endTag</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">DeleteNode</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">Error</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING</span><span class="p">,</span><span class="w"> </span><span class="n">initialLineNum</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">XMLDeclaration</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">decl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ToDeclaration</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">decl</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Declarations are only allowed at document level</span>
<span class="w">            </span><span class="c1">//</span>
<span class="w">            </span><span class="c1">// Multiple declarations are allowed but all declarations</span>
<span class="w">            </span><span class="c1">// must occur before anything else.</span>
<span class="w">            </span><span class="c1">//</span>
<span class="w">            </span><span class="c1">// Optimized due to a security test case. If the first node is</span>
<span class="w">            </span><span class="c1">// a declaration, and the last node is a declaration, then only</span>
<span class="w">            </span><span class="c1">// declarations have so far been added.</span>
<span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">wellLocated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ToDocument</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">FirstChild</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">wellLocated</span><span class="w"> </span><span class="o">=</span>
<span class="w">                        </span><span class="n">FirstChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                        </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToDeclaration</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                        </span><span class="n">LastChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                        </span><span class="n">LastChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToDeclaration</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">wellLocated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">wellLocated</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING_DECLARATION</span><span class="p">,</span><span class="w"> </span><span class="n">initialLineNum</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;XMLDeclaration value=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">decl</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">());</span>
<span class="w">                </span><span class="n">DeleteNode</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">ele</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ToElement</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ele</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// We read the end tag. Return it to the parent.</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ele</span><span class="o">-&gt;</span><span class="n">ClosingType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">CLOSING</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">parentEndTag</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">ele</span><span class="o">-&gt;</span><span class="n">_value</span><span class="p">.</span><span class="n">TransferTo</span><span class="p">(</span><span class="w"> </span><span class="n">parentEndTag</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_memPool</span><span class="o">-&gt;</span><span class="n">SetTracked</span><span class="p">();</span><span class="w">   </span><span class="c1">// created and then immediately deleted.</span>
<span class="w">                </span><span class="n">DeleteNode</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// Handle an end tag returned to this level.</span>
<span class="w">            </span><span class="c1">// And handle a bunch of annoying errors.</span>
<span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">endTag</span><span class="p">.</span><span class="n">Empty</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ele</span><span class="o">-&gt;</span><span class="n">ClosingType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">OPEN</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">mismatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ele</span><span class="o">-&gt;</span><span class="n">ClosingType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">OPEN</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">mismatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">endTag</span><span class="p">.</span><span class="n">GetStr</span><span class="p">(),</span><span class="w"> </span><span class="n">ele</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">mismatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mismatch</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_MISMATCHED_ELEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">initialLineNum</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;XMLElement name=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ele</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">());</span>
<span class="w">                </span><span class="n">DeleteNode</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">InsertEndChild</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*static*/</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">DeleteNode</span><span class="p">(</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_document</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ToDocument</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">MarkInUse</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">MemPool</span><span class="o">*</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_memPool</span><span class="p">;</span>
<span class="w">    </span><span class="n">node</span><span class="o">-&gt;~</span><span class="n">XMLNode</span><span class="p">();</span>
<span class="w">    </span><span class="n">pool</span><span class="o">-&gt;</span><span class="n">Free</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">InsertChildPreamble</span><span class="p">(</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">insertThis</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">insertThis</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">insertThis</span><span class="o">-&gt;</span><span class="n">_document</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_document</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">insertThis</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">insertThis</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="o">-&gt;</span><span class="n">Unlink</span><span class="p">(</span><span class="w"> </span><span class="n">insertThis</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">insertThis</span><span class="o">-&gt;</span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">MarkInUse</span><span class="p">(</span><span class="n">insertThis</span><span class="p">);</span>
<span class="w">        </span><span class="n">insertThis</span><span class="o">-&gt;</span><span class="n">_memPool</span><span class="o">-&gt;</span><span class="n">SetTracked</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">ToElementWithName</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">ToElement</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">element</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">(),</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// --------- XMLText ---------- //</span>
<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLText</span><span class="o">::</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">CData</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">ParseText</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;]]&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">NEEDS_NEWLINE_NORMALIZATION</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING_CDATA</span><span class="p">,</span><span class="w"> </span><span class="n">_parseLineNum</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">ProcessEntities</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">TEXT_ELEMENT</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">TEXT_ELEMENT_LEAVE_ENTITIES</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">WhitespaceMode</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">COLLAPSE_WHITESPACE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">flags</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">NEEDS_WHITESPACE_COLLAPSING</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">ParseText</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&lt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="mi">-1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING_TEXT</span><span class="p">,</span><span class="w"> </span><span class="n">_parseLineNum</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">XMLText</span><span class="o">::</span><span class="n">ShallowClone</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">XMLText</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="o">-&gt;</span><span class="n">NewText</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w">    </span><span class="c1">// fixme: this will always allocate memory. Intern?</span>
<span class="w">    </span><span class="n">text</span><span class="o">-&gt;</span><span class="n">SetCData</span><span class="p">(</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">CData</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLText</span><span class="o">::</span><span class="n">ShallowEqual</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XMLText</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compare</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">text</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLText</span><span class="o">::</span><span class="n">Accept</span><span class="p">(</span><span class="w"> </span><span class="n">XMLVisitor</span><span class="o">*</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">visitor</span><span class="o">-&gt;</span><span class="n">Visit</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// --------- XMLComment ---------- //</span>

<span class="n">XMLComment</span><span class="o">::</span><span class="n">XMLComment</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">XMLNode</span><span class="p">(</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>


<span class="n">XMLComment</span><span class="o">::~</span><span class="n">XMLComment</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>


<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLComment</span><span class="o">::</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Comment parses as text.</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">ParseText</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">COMMENT</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING_COMMENT</span><span class="p">,</span><span class="w"> </span><span class="n">_parseLineNum</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">XMLComment</span><span class="o">::</span><span class="n">ShallowClone</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">XMLComment</span><span class="o">*</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="o">-&gt;</span><span class="n">NewComment</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">// fixme: this will always allocate memory. Intern?</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">comment</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLComment</span><span class="o">::</span><span class="n">ShallowEqual</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XMLComment</span><span class="o">*</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compare</span><span class="o">-&gt;</span><span class="n">ToComment</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">comment</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLComment</span><span class="o">::</span><span class="n">Accept</span><span class="p">(</span><span class="w"> </span><span class="n">XMLVisitor</span><span class="o">*</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">visitor</span><span class="o">-&gt;</span><span class="n">Visit</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// --------- XMLDeclaration ---------- //</span>

<span class="n">XMLDeclaration</span><span class="o">::</span><span class="n">XMLDeclaration</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">XMLNode</span><span class="p">(</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>


<span class="n">XMLDeclaration</span><span class="o">::~</span><span class="n">XMLDeclaration</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//printf( &quot;~XMLDeclaration\n&quot; );</span>
<span class="p">}</span>


<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDeclaration</span><span class="o">::</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Declaration parses as text.</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">ParseText</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;?&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">NEEDS_NEWLINE_NORMALIZATION</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING_DECLARATION</span><span class="p">,</span><span class="w"> </span><span class="n">_parseLineNum</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDeclaration</span><span class="o">::</span><span class="n">ShallowClone</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">XMLDeclaration</span><span class="o">*</span><span class="w"> </span><span class="n">dec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="o">-&gt;</span><span class="n">NewDeclaration</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">// fixme: this will always allocate memory. Intern?</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dec</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLDeclaration</span><span class="o">::</span><span class="n">ShallowEqual</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XMLDeclaration</span><span class="o">*</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compare</span><span class="o">-&gt;</span><span class="n">ToDeclaration</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">declaration</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">));</span>
<span class="p">}</span>



<span class="kt">bool</span><span class="w"> </span><span class="n">XMLDeclaration</span><span class="o">::</span><span class="n">Accept</span><span class="p">(</span><span class="w"> </span><span class="n">XMLVisitor</span><span class="o">*</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">visitor</span><span class="o">-&gt;</span><span class="n">Visit</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// --------- XMLUnknown ---------- //</span>

<span class="n">XMLUnknown</span><span class="o">::</span><span class="n">XMLUnknown</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">XMLNode</span><span class="p">(</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>


<span class="n">XMLUnknown</span><span class="o">::~</span><span class="n">XMLUnknown</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>


<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLUnknown</span><span class="o">::</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Unknown parses as text.</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">ParseText</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">NEEDS_NEWLINE_NORMALIZATION</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING_UNKNOWN</span><span class="p">,</span><span class="w"> </span><span class="n">_parseLineNum</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">XMLUnknown</span><span class="o">::</span><span class="n">ShallowClone</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">XMLUnknown</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="o">-&gt;</span><span class="n">NewUnknown</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// fixme: this will always allocate memory. Intern?</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLUnknown</span><span class="o">::</span><span class="n">ShallowEqual</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XMLUnknown</span><span class="o">*</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compare</span><span class="o">-&gt;</span><span class="n">ToUnknown</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">unknown</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLUnknown</span><span class="o">::</span><span class="n">Accept</span><span class="p">(</span><span class="w"> </span><span class="n">XMLVisitor</span><span class="o">*</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">visitor</span><span class="o">-&gt;</span><span class="n">Visit</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// --------- XMLAttribute ---------- //</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">Name</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_name</span><span class="p">.</span><span class="n">GetStr</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">GetStr</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">processEntities</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Parse using the name rules: bug fix, was using ParseText before</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_name</span><span class="p">.</span><span class="n">ParseName</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">p</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Skip white space before =</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">SkipWhiteSpace</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;=&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">++</span><span class="n">p</span><span class="p">;</span><span class="w">    </span><span class="c1">// move up to opening quote</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">SkipWhiteSpace</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;\&quot;&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">endTag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="o">++</span><span class="n">p</span><span class="p">;</span><span class="w">    </span><span class="c1">// move past opening quote</span>

<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">ParseText</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">endTag</span><span class="p">,</span><span class="w"> </span><span class="n">processEntities</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">ATTRIBUTE_VALUE</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">StrPair</span><span class="o">::</span><span class="n">ATTRIBUTE_VALUE_LEAVE_ENTITIES</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">SetName</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_name</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">QueryIntValue</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToInt</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_WRONG_ATTRIBUTE_TYPE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">QueryUnsignedValue</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToUnsigned</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_WRONG_ATTRIBUTE_TYPE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">QueryInt64Value</span><span class="p">(</span><span class="kt">int64_t</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToInt64</span><span class="p">(</span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_WRONG_ATTRIBUTE_TYPE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">QueryUnsigned64Value</span><span class="p">(</span><span class="kt">uint64_t</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToUnsigned64</span><span class="p">(</span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_WRONG_ATTRIBUTE_TYPE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">QueryBoolValue</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToBool</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_WRONG_ATTRIBUTE_TYPE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">QueryFloatValue</span><span class="p">(</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToFloat</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_WRONG_ATTRIBUTE_TYPE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">QueryDoubleValue</span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToDouble</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_WRONG_ATTRIBUTE_TYPE</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">SetAttribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_value</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">SetAttribute</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_value</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">SetAttribute</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_value</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">SetAttribute</span><span class="p">(</span><span class="kt">int64_t</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<span class="w">    </span><span class="n">_value</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">SetAttribute</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<span class="w">    </span><span class="n">_value</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">SetAttribute</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_value</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">SetAttribute</span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_value</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">::</span><span class="n">SetAttribute</span><span class="p">(</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_value</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// --------- XMLElement ---------- //</span>
<span class="n">XMLElement</span><span class="o">::</span><span class="n">XMLElement</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">XMLNode</span><span class="p">(</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_closingType</span><span class="p">(</span><span class="w"> </span><span class="n">OPEN</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_rootAttribute</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>


<span class="n">XMLElement</span><span class="o">::~</span><span class="n">XMLElement</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">_rootAttribute</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_rootAttribute</span><span class="o">-&gt;</span><span class="n">_next</span><span class="p">;</span>
<span class="w">        </span><span class="n">DeleteAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">_rootAttribute</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">_rootAttribute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="k">const</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">FindAttribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_rootAttribute</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">(),</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">Attribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">a</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">value</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">IntAttribute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryIntAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">unsigned</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">UnsignedAttribute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryUnsignedAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int64_t</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">Int64Attribute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryInt64Attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">uint64_t</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">Unsigned64Attribute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryUnsigned64Attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">BoolAttribute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryBoolAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">DoubleAttribute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryDoubleAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">FloatAttribute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryFloatAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">f</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">GetText</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/* skip comment node */</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">();</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ToComment</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">NextSibling</span><span class="p">();</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w">    </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">inText</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">()</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetValue</span><span class="p">(</span><span class="w"> </span><span class="n">inText</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XMLText</span><span class="o">*</span><span class="w">    </span><span class="n">theText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetDocument</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">NewText</span><span class="p">(</span><span class="w"> </span><span class="n">inText</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">InsertFirstChild</span><span class="p">(</span><span class="w"> </span><span class="n">theText</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">SetText</span><span class="p">(</span><span class="kt">int64_t</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetText</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">SetText</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<span class="w">    </span><span class="n">SetText</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">SetText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">QueryIntText</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">ival</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToInt</span><span class="p">(</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">ival</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_CAN_NOT_CONVERT_TEXT</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_NO_TEXT_NODE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">QueryUnsignedText</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="o">*</span><span class="w"> </span><span class="n">uval</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToUnsigned</span><span class="p">(</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">uval</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_CAN_NOT_CONVERT_TEXT</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_NO_TEXT_NODE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">QueryInt64Text</span><span class="p">(</span><span class="kt">int64_t</span><span class="o">*</span><span class="w"> </span><span class="n">ival</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">FirstChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToInt64</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">ival</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_CAN_NOT_CONVERT_TEXT</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_NO_TEXT_NODE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">QueryUnsigned64Text</span><span class="p">(</span><span class="kt">uint64_t</span><span class="o">*</span><span class="w"> </span><span class="n">ival</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">FirstChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToUnsigned64</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">ival</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_CAN_NOT_CONVERT_TEXT</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_NO_TEXT_NODE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">QueryBoolText</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">bval</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToBool</span><span class="p">(</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">bval</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_CAN_NOT_CONVERT_TEXT</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_NO_TEXT_NODE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">QueryDoubleText</span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">dval</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToDouble</span><span class="p">(</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">dval</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_CAN_NOT_CONVERT_TEXT</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_NO_TEXT_NODE</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">QueryFloatText</span><span class="p">(</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">fval</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToText</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FirstChild</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToFloat</span><span class="p">(</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">fval</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">XML_CAN_NOT_CONVERT_TEXT</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">XML_NO_TEXT_NODE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">IntText</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryIntText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">unsigned</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">UnsignedText</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryUnsignedText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int64_t</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">Int64Text</span><span class="p">(</span><span class="kt">int64_t</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryInt64Text</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">uint64_t</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">Unsigned64Text</span><span class="p">(</span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryUnsigned64Text</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">BoolText</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryBoolText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">double</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">DoubleText</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryDoubleText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">FloatText</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueryFloatText</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">FindOrCreateAttribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">attrib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">attrib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_rootAttribute</span><span class="p">;</span>
<span class="w">            </span><span class="n">attrib</span><span class="p">;</span>
<span class="w">            </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrib</span><span class="p">,</span><span class="w"> </span><span class="n">attrib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrib</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">attrib</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">(),</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">attrib</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">attrib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateAttribute</span><span class="p">();</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">attrib</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">last</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="n">last</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrib</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_rootAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="n">_rootAttribute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrib</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">attrib</span><span class="o">-&gt;</span><span class="n">SetName</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">attrib</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">DeleteAttribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">_rootAttribute</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">prev</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">_next</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_rootAttribute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">_next</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">DeleteAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">ParseAttributes</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">prevAttribute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Read the attributes.</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">SkipWhiteSpace</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING_ELEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">_parseLineNum</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;XMLElement name=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// attribute.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">IsNameStartChar</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">attrib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateAttribute</span><span class="p">();</span>
<span class="w">            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">attrib</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="n">attrib</span><span class="o">-&gt;</span><span class="n">_parseLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">_parseCurLineNum</span><span class="p">;</span>

<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">attrLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrib</span><span class="o">-&gt;</span><span class="n">_parseLineNum</span><span class="p">;</span>

<span class="w">            </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrib</span><span class="o">-&gt;</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">ProcessEntities</span><span class="p">(),</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">p</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">Attribute</span><span class="p">(</span><span class="w"> </span><span class="n">attrib</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">DeleteAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">attrib</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING_ATTRIBUTE</span><span class="p">,</span><span class="w"> </span><span class="n">attrLineNum</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;XMLElement name=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// There is a minor bug here: if the attribute in the source xml</span>
<span class="w">            </span><span class="c1">// document is duplicated, it will not be detected and the</span>
<span class="w">            </span><span class="c1">// attribute will be doubly added. However, tracking the &#39;prevAttribute&#39;</span>
<span class="w">            </span><span class="c1">// avoids re-scanning the attribute list. Preferring performance for</span>
<span class="w">            </span><span class="c1">// now, may reconsider in the future.</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">prevAttribute</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">prevAttribute</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="n">prevAttribute</span><span class="o">-&gt;</span><span class="n">_next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrib</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_rootAttribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">                </span><span class="n">_rootAttribute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrib</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">prevAttribute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrib</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// end of the tag</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;&gt;&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// end of the tag</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;&gt;&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">_closingType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CLOSED</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// done; sealed element.</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_PARSING_ELEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">_parseLineNum</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">DeleteAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">MemPool</span><span class="o">*</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attribute</span><span class="o">-&gt;</span><span class="n">_memPool</span><span class="p">;</span>
<span class="w">    </span><span class="n">attribute</span><span class="o">-&gt;~</span><span class="n">XMLAttribute</span><span class="p">();</span>
<span class="w">    </span><span class="n">pool</span><span class="o">-&gt;</span><span class="n">Free</span><span class="p">(</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">CreateAttribute</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">_attributePool</span><span class="p">.</span><span class="n">ItemSize</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">attrib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="p">(</span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">_attributePool</span><span class="p">.</span><span class="n">Alloc</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="p">();</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">attrib</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">attrib</span><span class="o">-&gt;</span><span class="n">_memPool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">_attributePool</span><span class="p">;</span>
<span class="w">    </span><span class="n">attrib</span><span class="o">-&gt;</span><span class="n">_memPool</span><span class="o">-&gt;</span><span class="n">SetTracked</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">attrib</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">InsertNewChildElement</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">NewElement</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">InsertEndChild</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">XMLComment</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">InsertNewComment</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">comment</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLComment</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">NewComment</span><span class="p">(</span><span class="n">comment</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">InsertEndChild</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">XMLText</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">InsertNewText</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLText</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">NewText</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">InsertEndChild</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">XMLDeclaration</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">InsertNewDeclaration</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLDeclaration</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">NewDeclaration</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">InsertEndChild</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">XMLUnknown</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">InsertNewUnknown</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLUnknown</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="o">-&gt;</span><span class="n">NewUnknown</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">InsertEndChild</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>



<span class="c1">//</span>
<span class="c1">//  &lt;ele&gt;&lt;/ele&gt;</span>
<span class="c1">//  &lt;ele&gt;foo&lt;b&gt;bar&lt;/b&gt;&lt;/ele&gt;</span>
<span class="c1">//</span>
<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">StrPair</span><span class="o">*</span><span class="w"> </span><span class="n">parentEndTag</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Read the element name.</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">SkipWhiteSpace</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// The closing element is the &lt;/element&gt; form. It is</span>
<span class="w">    </span><span class="c1">// parsed just like a regular element then deleted from</span>
<span class="w">    </span><span class="c1">// the DOM.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;/&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_closingType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CLOSING</span><span class="p">;</span>
<span class="w">        </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">ParseName</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_value</span><span class="p">.</span><span class="n">Empty</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ParseAttributes</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">p</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!*</span><span class="n">p</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">_closingType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OPEN</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">ParseDeep</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">parentEndTag</span><span class="p">,</span><span class="w"> </span><span class="n">curLineNumPtr</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="p">}</span>



<span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">ShallowClone</span><span class="p">(</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">doc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_document</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="o">-&gt;</span><span class="n">NewElement</span><span class="p">(</span><span class="w"> </span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w">                   </span><span class="c1">// fixme: this will always allocate memory. Intern?</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">FirstAttribute</span><span class="p">();</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Next</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">element</span><span class="o">-&gt;</span><span class="n">SetAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">(),</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w">                 </span><span class="c1">// fixme: this will always allocate memory. Intern?</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">ShallowEqual</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compare</span><span class="o">-&gt;</span><span class="n">ToElement</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">other</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">(),</span><span class="w"> </span><span class="n">Name</span><span class="p">()</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">FirstAttribute</span><span class="p">();</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="n">other</span><span class="o">-&gt;</span><span class="n">FirstAttribute</span><span class="p">();</span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">StringEqual</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">Next</span><span class="p">();</span>
<span class="w">            </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">Next</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// different count</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">::</span><span class="n">Accept</span><span class="p">(</span><span class="w"> </span><span class="n">XMLVisitor</span><span class="o">*</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="o">-&gt;</span><span class="n">VisitEnter</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">_rootAttribute</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="o">=</span><span class="n">FirstChild</span><span class="p">();</span><span class="w"> </span><span class="n">node</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">NextSibling</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">Accept</span><span class="p">(</span><span class="w"> </span><span class="n">visitor</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">visitor</span><span class="o">-&gt;</span><span class="n">VisitExit</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// --------- XMLDocument ----------- //</span>

<span class="c1">// Warning: List must match &#39;enum XMLError&#39;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">_errorNames</span><span class="p">[</span><span class="n">XML_ERROR_COUNT</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;XML_SUCCESS&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_NO_ATTRIBUTE&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_WRONG_ATTRIBUTE_TYPE&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_FILE_NOT_FOUND&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_FILE_COULD_NOT_BE_OPENED&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_FILE_READ_ERROR&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_PARSING_ELEMENT&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_PARSING_ATTRIBUTE&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_PARSING_TEXT&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_PARSING_CDATA&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_PARSING_COMMENT&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_PARSING_DECLARATION&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_PARSING_UNKNOWN&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_EMPTY_DOCUMENT&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_MISMATCHED_ELEMENT&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ERROR_PARSING&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_CAN_NOT_CONVERT_TEXT&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_NO_TEXT_NODE&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;XML_ELEMENT_DEPTH_EXCEEDED&quot;</span>
<span class="p">};</span>


<span class="n">XMLDocument</span><span class="o">::</span><span class="n">XMLDocument</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">processEntities</span><span class="p">,</span><span class="w"> </span><span class="n">Whitespace</span><span class="w"> </span><span class="n">whitespaceMode</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<span class="w">    </span><span class="n">XMLNode</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_writeBOM</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_processEntities</span><span class="p">(</span><span class="w"> </span><span class="n">processEntities</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_errorID</span><span class="p">(</span><span class="n">XML_SUCCESS</span><span class="p">),</span>
<span class="w">    </span><span class="n">_whitespaceMode</span><span class="p">(</span><span class="w"> </span><span class="n">whitespaceMode</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_errorStr</span><span class="p">(),</span>
<span class="w">    </span><span class="n">_errorLineNum</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_charBuffer</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_parseCurLineNum</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_parsingDepth</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">_unlinked</span><span class="p">(),</span>
<span class="w">    </span><span class="n">_elementPool</span><span class="p">(),</span>
<span class="w">    </span><span class="n">_attributePool</span><span class="p">(),</span>
<span class="w">    </span><span class="n">_textPool</span><span class="p">(),</span>
<span class="w">    </span><span class="n">_commentPool</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// avoid VC++ C4355 warning about &#39;this&#39; in initializer list (C4355 is off by default in VS2012+)</span>
<span class="w">    </span><span class="n">_document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLDocument</span><span class="o">::~</span><span class="n">XMLDocument</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Clear</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">MarkInUse</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">node</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">_unlinked</span><span class="p">.</span><span class="n">Size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_unlinked</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">_unlinked</span><span class="p">.</span><span class="n">SwapRemove</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">Clear</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">DeleteChildren</span><span class="p">();</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">_unlinked</span><span class="p">.</span><span class="n">Size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DeleteNode</span><span class="p">(</span><span class="n">_unlinked</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w">   </span><span class="c1">// Will remove from _unlinked as part of delete.</span>
<span class="w">    </span><span class="p">}</span>

<span class="cp">#ifdef TINYXML2_DEBUG</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hadError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Error</span><span class="p">();</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="n">ClearError</span><span class="p">();</span>

<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="n">_charBuffer</span><span class="p">;</span>
<span class="w">    </span><span class="n">_charBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">_parsingDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="cp">#if 0</span>
<span class="c">    _textPool.Trace( &quot;text&quot; );</span>
<span class="c">    _elementPool.Trace( &quot;element&quot; );</span>
<span class="c">    _commentPool.Trace( &quot;comment&quot; );</span>
<span class="c">    _attributePool.Trace( &quot;attribute&quot; );</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef TINYXML2_DEBUG</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">hadError</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_elementPool</span><span class="p">.</span><span class="n">CurrentAllocs</span><span class="p">()</span><span class="w">   </span><span class="o">==</span><span class="w"> </span><span class="n">_elementPool</span><span class="p">.</span><span class="n">Untracked</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_attributePool</span><span class="p">.</span><span class="n">CurrentAllocs</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_attributePool</span><span class="p">.</span><span class="n">Untracked</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_textPool</span><span class="p">.</span><span class="n">CurrentAllocs</span><span class="p">()</span><span class="w">      </span><span class="o">==</span><span class="w"> </span><span class="n">_textPool</span><span class="p">.</span><span class="n">Untracked</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_commentPool</span><span class="p">.</span><span class="n">CurrentAllocs</span><span class="p">()</span><span class="w">   </span><span class="o">==</span><span class="w"> </span><span class="n">_commentPool</span><span class="p">.</span><span class="n">Untracked</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="cp">#endif</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">DeepCopy</span><span class="p">(</span><span class="n">XMLDocument</span><span class="o">*</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">target</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// technically success - a no-op.</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">target</span><span class="o">-&gt;</span><span class="n">Clear</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">FirstChild</span><span class="p">();</span><span class="w"> </span><span class="n">node</span><span class="p">;</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">NextSibling</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">target</span><span class="o">-&gt;</span><span class="n">InsertEndChild</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">DeepClone</span><span class="p">(</span><span class="n">target</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">NewElement</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">ele</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLElement</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_elementPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">ele</span><span class="o">-&gt;</span><span class="n">SetName</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ele</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLComment</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">NewComment</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLComment</span><span class="o">*</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLComment</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_commentPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">comment</span><span class="o">-&gt;</span><span class="n">SetValue</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">comment</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLText</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">NewText</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLText</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLText</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_textPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">text</span><span class="o">-&gt;</span><span class="n">SetValue</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLDeclaration</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">NewDeclaration</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLDeclaration</span><span class="o">*</span><span class="w"> </span><span class="n">dec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLDeclaration</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_commentPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">dec</span><span class="o">-&gt;</span><span class="n">SetValue</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;xml version=</span><span class="se">\&quot;</span><span class="s">1.0</span><span class="se">\&quot;</span><span class="s"> encoding=</span><span class="se">\&quot;</span><span class="s">UTF-8</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dec</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLUnknown</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">NewUnknown</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XMLUnknown</span><span class="o">*</span><span class="w"> </span><span class="n">unk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateUnlinkedNode</span><span class="o">&lt;</span><span class="n">XMLUnknown</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">_commentPool</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">unk</span><span class="o">-&gt;</span><span class="n">SetValue</span><span class="p">(</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">unk</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">callfopen</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">filepath</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">filepath</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="p">);</span>
<span class="cp">#if defined(_MSC_VER) &amp;&amp; (_MSC_VER &gt;= 1400 ) &amp;&amp; (!defined WINCE)</span>
<span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">errno_t</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen_s</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="n">filepath</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="w"> </span><span class="n">filepath</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">DeleteNode</span><span class="p">(</span><span class="w"> </span><span class="n">XMLNode</span><span class="o">*</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_document</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_parent</span><span class="o">-&gt;</span><span class="n">DeleteChild</span><span class="p">(</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Isn&#39;t in the tree.</span>
<span class="w">        </span><span class="c1">// Use the parent delete.</span>
<span class="w">        </span><span class="c1">// Also, we need to mark it tracked: we &#39;know&#39;</span>
<span class="w">        </span><span class="c1">// it was never used.</span>
<span class="w">        </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">_memPool</span><span class="o">-&gt;</span><span class="n">SetTracked</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// Call the static XMLNode version:</span>
<span class="w">        </span><span class="n">XMLNode</span><span class="o">::</span><span class="n">DeleteNode</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">LoadFile</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_FILE_COULD_NOT_BE_OPENED</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;filename=&lt;null&gt;&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">Clear</span><span class="p">();</span>
<span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">callfopen</span><span class="p">(</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rb&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">fp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_FILE_NOT_FOUND</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;filename=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">LoadFile</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">LoadFile</span><span class="p">(</span><span class="w"> </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Clear</span><span class="p">();</span>

<span class="w">    </span><span class="n">TIXML_FSEEK</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_SET</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fgetc</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EOF</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ferror</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_FILE_READ_ERROR</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">TIXML_FSEEK</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_END</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">filelength</span><span class="p">;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">fileLengthSigned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TIXML_FTELL</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXML_FSEEK</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">SEEK_SET</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">fileLengthSigned</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1L</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_FILE_READ_ERROR</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">fileLengthSigned</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">filelength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fileLengthSigned</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">maxSizeT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// We&#39;ll do the comparison as an unsigned long long, because that&#39;s guaranteed to be at</span>
<span class="w">    </span><span class="c1">// least 8 bytes, even on a 32-bit platform.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">filelength</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">maxSizeT</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Cannot handle files which won&#39;t fit in buffer together with null terminator</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_FILE_READ_ERROR</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">filelength</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_EMPTY_DOCUMENT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">filelength</span><span class="p">);</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_charBuffer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_charBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="w"> </span><span class="n">_charBuffer</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_FILE_READ_ERROR</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">_charBuffer</span><span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="n">Parse</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">SaveFile</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">compact</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">filename</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_FILE_COULD_NOT_BE_OPENED</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;filename=&lt;null&gt;&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">callfopen</span><span class="p">(</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;w&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">fp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_FILE_COULD_NOT_BE_OPENED</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;filename=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">SaveFile</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="n">compact</span><span class="p">);</span>
<span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">SaveFile</span><span class="p">(</span><span class="w"> </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">compact</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Clear any error from the last save, otherwise it will get reported</span>
<span class="w">    </span><span class="c1">// for *this* call.</span>
<span class="w">    </span><span class="n">ClearError</span><span class="p">();</span>
<span class="w">    </span><span class="n">XMLPrinter</span><span class="w"> </span><span class="nf">stream</span><span class="p">(</span><span class="w"> </span><span class="n">fp</span><span class="p">,</span><span class="w"> </span><span class="n">compact</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Print</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stream</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">XMLError</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">Parse</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Clear</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">p</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_EMPTY_DOCUMENT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_charBuffer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_charBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="w"> </span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">];</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="w"> </span><span class="n">_charBuffer</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_charBuffer</span><span class="p">[</span><span class="n">len</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="n">Parse</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Error</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// clean up now essentially dangling memory.</span>
<span class="w">        </span><span class="c1">// and the parse fail can put objects in the</span>
<span class="w">        </span><span class="c1">// pools that are dead and inaccessible.</span>
<span class="w">        </span><span class="n">DeleteChildren</span><span class="p">();</span>
<span class="w">        </span><span class="n">_elementPool</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<span class="w">        </span><span class="n">_attributePool</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<span class="w">        </span><span class="n">_textPool</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<span class="w">        </span><span class="n">_commentPool</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_errorID</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">Print</span><span class="p">(</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">*</span><span class="w"> </span><span class="n">streamer</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">streamer</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Accept</span><span class="p">(</span><span class="w"> </span><span class="n">streamer</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">XMLPrinter</span><span class="w"> </span><span class="nf">stdoutStreamer</span><span class="p">(</span><span class="w"> </span><span class="n">stdout</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">Accept</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stdoutStreamer</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">ClearError</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">_errorID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XML_SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="n">_errorLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">_errorStr</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XMLError</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lineNum</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">XML_ERROR_COUNT</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_errorID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="w">    </span><span class="n">_errorLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lineNum</span><span class="p">;</span>
<span class="w">    </span><span class="n">_errorStr</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="n">BUFFER_SIZE</span><span class="p">];</span>

<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
<span class="w">    </span><span class="n">TIXML_SNPRINTF</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error=%s ErrorID=%d (0x%x) Line number=%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ErrorIDToName</span><span class="p">(</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">lineNum</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">format</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXML_SNPRINTF</span><span class="p">(</span><span class="n">buffer</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>

<span class="w">        </span><span class="kt">va_list</span><span class="w"> </span><span class="n">va</span><span class="p">;</span>
<span class="w">        </span><span class="n">va_start</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXML_VSNPRINTF</span><span class="p">(</span><span class="n">buffer</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">va</span><span class="p">);</span>
<span class="w">        </span><span class="n">va_end</span><span class="p">(</span><span class="n">va</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">_errorStr</span><span class="p">.</span><span class="n">SetStr</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*static*/</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">ErrorIDToName</span><span class="p">(</span><span class="n">XMLError</span><span class="w"> </span><span class="n">errorID</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">errorID</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">errorID</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">XML_ERROR_COUNT</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">errorName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_errorNames</span><span class="p">[</span><span class="n">errorID</span><span class="p">];</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">errorName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">errorName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">errorName</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">ErrorStr</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">_errorStr</span><span class="p">.</span><span class="n">Empty</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">_errorStr</span><span class="p">.</span><span class="n">GetStr</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">PrintError</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ErrorStr</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">ErrorName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ErrorIDToName</span><span class="p">(</span><span class="n">_errorID</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">Parse</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">NoChildren</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// Clear() must have been called previously</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_charBuffer</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_parseCurLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">_parseLineNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_charBuffer</span><span class="p">;</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">SkipWhiteSpace</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_parseCurLineNum</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ReadBOM</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_writeBOM</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!*</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="w"> </span><span class="n">XML_ERROR_EMPTY_DOCUMENT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">ParseDeep</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">_parseCurLineNum</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">PushDepth</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_parsingDepth</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_parsingDepth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TINYXML2_MAX_ELEMENT_DEPTH</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SetError</span><span class="p">(</span><span class="n">XML_ELEMENT_DEPTH_EXCEEDED</span><span class="p">,</span><span class="w"> </span><span class="n">_parseCurLineNum</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Element nesting is too deep.&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">::</span><span class="n">PopDepth</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="n">_parsingDepth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="o">--</span><span class="n">_parsingDepth</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">XMLPrinter</span><span class="o">::</span><span class="n">XMLPrinter</span><span class="p">(</span><span class="w"> </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">compact</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<span class="w">    </span><span class="n">_elementJustOpened</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_stack</span><span class="p">(),</span>
<span class="w">    </span><span class="n">_firstElement</span><span class="p">(</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_fp</span><span class="p">(</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_depth</span><span class="p">(</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_textDepth</span><span class="p">(</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_processEntities</span><span class="p">(</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_compactMode</span><span class="p">(</span><span class="w"> </span><span class="n">compact</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">_buffer</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">ENTITY_RANGE</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_entityFlag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">_restrictedEntityFlag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_ENTITIES</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">entityValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">;</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">flagIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">entityValue</span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">flagIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ENTITY_RANGE</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">_entityFlag</span><span class="p">[</span><span class="n">flagIndex</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">_restrictedEntityFlag</span><span class="p">[</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="sc">&#39;&amp;&#39;</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">_restrictedEntityFlag</span><span class="p">[</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="sc">&#39;&lt;&#39;</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">_restrictedEntityFlag</span><span class="p">[</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="sc">&#39;&gt;&#39;</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w">  </span><span class="c1">// not required, but consistency is nice</span>
<span class="w">    </span><span class="n">_buffer</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">Print</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">va_list</span><span class="w">     </span><span class="n">va</span><span class="p">;</span>
<span class="w">    </span><span class="n">va_start</span><span class="p">(</span><span class="w"> </span><span class="n">va</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_fp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">vfprintf</span><span class="p">(</span><span class="w"> </span><span class="n">_fp</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TIXML_VSCPRINTF</span><span class="p">(</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="c1">// Close out and re-start the va-args</span>
<span class="w">        </span><span class="n">va_end</span><span class="p">(</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">va_start</span><span class="p">(</span><span class="w"> </span><span class="n">va</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_buffer</span><span class="p">.</span><span class="n">Size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">_buffer</span><span class="p">[</span><span class="n">_buffer</span><span class="p">.</span><span class="n">Size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_buffer</span><span class="p">.</span><span class="n">PushArr</span><span class="p">(</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">   </span><span class="c1">// back up over the null terminator.</span>
<span class="w">        </span><span class="n">TIXML_VSNPRINTF</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">va_end</span><span class="p">(</span><span class="w"> </span><span class="n">va</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_fp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fwrite</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">_fp</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_buffer</span><span class="p">.</span><span class="n">PushArr</span><span class="p">(</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">   </span><span class="c1">// back up over the null terminator.</span>
<span class="w">        </span><span class="n">memcpy</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="n">size</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">Putc</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_fp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fputc</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ch</span><span class="p">,</span><span class="w"> </span><span class="n">_fp</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_buffer</span><span class="p">.</span><span class="n">PushArr</span><span class="p">(</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">   </span><span class="c1">// back up over the null terminator.</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ch</span><span class="p">;</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PrintSpace</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">depth</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;    &quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PrintString</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="k">restricted</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Look for runs of bytes between entities to print.</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_processEntities</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">restricted</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">_restrictedEntityFlag</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">_entityFlag</span><span class="p">;</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="c1">// Remember, char is sometimes signed. (How many times has that bitten me?)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ENTITY_RANGE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Check for entities. If one is found, flush</span>
<span class="w">                </span><span class="c1">// the stream up until the entity, write the</span>
<span class="w">                </span><span class="c1">// entity, and keep looking.</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">flag</span><span class="p">[</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">)]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
<span class="w">                        </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">toPrint</span><span class="w"> </span><span class="p">);</span>
<span class="w">                        </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">toPrint</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="kt">bool</span><span class="w"> </span><span class="n">entityPatternPrinted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">                    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_ENTITIES</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">Putc</span><span class="p">(</span><span class="w"> </span><span class="sc">&#39;&amp;&#39;</span><span class="w"> </span><span class="p">);</span>
<span class="w">                            </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">length</span><span class="w"> </span><span class="p">);</span>
<span class="w">                            </span><span class="n">Putc</span><span class="p">(</span><span class="w"> </span><span class="sc">&#39;;&#39;</span><span class="w"> </span><span class="p">);</span>
<span class="w">                            </span><span class="n">entityPatternPrinted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">                            </span><span class="k">break</span><span class="p">;</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">entityPatternPrinted</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="c1">// TIXMLASSERT( entityPatternPrinted ) causes gcc -Wunused-but-set-variable in release</span>
<span class="w">                        </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="o">++</span><span class="n">p</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="o">++</span><span class="n">q</span><span class="p">;</span>
<span class="w">            </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Flush the remaining string. This will be the entire</span>
<span class="w">        </span><span class="c1">// string if an entity wasn&#39;t found.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">toPrint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
<span class="w">            </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">toPrint</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushHeader</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">writeBOM</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">writeDec</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">writeBOM</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">bom</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TIXML_UTF_LEAD_0</span><span class="p">,</span><span class="w"> </span><span class="n">TIXML_UTF_LEAD_1</span><span class="p">,</span><span class="w"> </span><span class="n">TIXML_UTF_LEAD_2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">bom</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">writeDec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PushDeclaration</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;xml version=</span><span class="se">\&quot;</span><span class="s">1.0</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PrepareForNewNode</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">compactMode</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SealElementIfJustOpened</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">compactMode</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_firstElement</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PrintSpace</span><span class="w"> </span><span class="p">(</span><span class="n">_depth</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_textDepth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Putc</span><span class="p">(</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">PrintSpace</span><span class="p">(</span><span class="w"> </span><span class="n">_depth</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">_firstElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">OpenElement</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">compactMode</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PrepareForNewNode</span><span class="p">(</span><span class="w"> </span><span class="n">compactMode</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">_stack</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="s">&quot;&lt;&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="n">_elementJustOpened</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="o">++</span><span class="n">_depth</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">TIXMLASSERT</span><span class="p">(</span><span class="w"> </span><span class="n">_elementJustOpened</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Putc</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;=</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PrintString</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Putc</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="sc">&#39;\&quot;&#39;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushAttribute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<span class="w">    </span><span class="n">PushAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushAttribute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<span class="w">    </span><span class="n">PushAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">CloseElement</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">compactMode</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">--</span><span class="n">_depth</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_stack</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_elementJustOpened</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;/&gt;&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_textDepth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">compactMode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Putc</span><span class="p">(</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="n">PrintSpace</span><span class="p">(</span><span class="w"> </span><span class="n">_depth</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="s">&quot;&lt;/&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="s">&quot;&gt;&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_textDepth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_depth</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_textDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">_depth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">compactMode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Putc</span><span class="p">(</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">_elementJustOpened</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">SealElementIfJustOpened</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">_elementJustOpened</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">_elementJustOpened</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">Putc</span><span class="p">(</span><span class="w"> </span><span class="sc">&#39;&gt;&#39;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">cdata</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_textDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_depth</span><span class="mi">-1</span><span class="p">;</span>

<span class="w">    </span><span class="n">SealElementIfJustOpened</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cdata</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;&lt;![CDATA[&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;]]&gt;&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PrintString</span><span class="p">(</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="p">);</span>
<span class="w">    </span><span class="n">PushText</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">BUF_SIZE</span><span class="p">];</span>
<span class="w">    </span><span class="n">XMLUtil</span><span class="o">::</span><span class="n">ToStr</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">BUF_SIZE</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushComment</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PrepareForNewNode</span><span class="p">(</span><span class="w"> </span><span class="n">_compactMode</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;&lt;!--&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;--&gt;&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushDeclaration</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PrepareForNewNode</span><span class="p">(</span><span class="w"> </span><span class="n">_compactMode</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;&lt;?&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;?&gt;&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">PushUnknown</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PrepareForNewNode</span><span class="p">(</span><span class="w"> </span><span class="n">_compactMode</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;&lt;!&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">Putc</span><span class="p">(</span><span class="w"> </span><span class="sc">&#39;&gt;&#39;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">VisitEnter</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLDocument</span><span class="o">&amp;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">_processEntities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">ProcessEntities</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">HasBOM</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PushHeader</span><span class="p">(</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">VisitEnter</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">&amp;</span><span class="w"> </span><span class="n">element</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLAttribute</span><span class="o">*</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">*</span><span class="w"> </span><span class="n">parentElem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">element</span><span class="p">.</span><span class="n">Parent</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">parentElem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element</span><span class="p">.</span><span class="n">Parent</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ToElement</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">compactMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentElem</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">CompactMode</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">parentElem</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">_compactMode</span><span class="p">;</span>
<span class="w">    </span><span class="n">OpenElement</span><span class="p">(</span><span class="w"> </span><span class="n">element</span><span class="p">.</span><span class="n">Name</span><span class="p">(),</span><span class="w"> </span><span class="n">compactMode</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PushAttribute</span><span class="p">(</span><span class="w"> </span><span class="n">attribute</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">(),</span><span class="w"> </span><span class="n">attribute</span><span class="o">-&gt;</span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">attribute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attribute</span><span class="o">-&gt;</span><span class="n">Next</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">VisitExit</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLElement</span><span class="o">&amp;</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">CloseElement</span><span class="p">(</span><span class="w"> </span><span class="n">CompactMode</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">Visit</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLText</span><span class="o">&amp;</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PushText</span><span class="p">(</span><span class="w"> </span><span class="n">text</span><span class="p">.</span><span class="n">Value</span><span class="p">(),</span><span class="w"> </span><span class="n">text</span><span class="p">.</span><span class="n">CData</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">Visit</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLComment</span><span class="o">&amp;</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PushComment</span><span class="p">(</span><span class="w"> </span><span class="n">comment</span><span class="p">.</span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">Visit</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLDeclaration</span><span class="o">&amp;</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PushDeclaration</span><span class="p">(</span><span class="w"> </span><span class="n">declaration</span><span class="p">.</span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span><span class="w"> </span><span class="n">XMLPrinter</span><span class="o">::</span><span class="n">Visit</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">XMLUnknown</span><span class="o">&amp;</span><span class="w"> </span><span class="n">unknown</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PushUnknown</span><span class="p">(</span><span class="w"> </span><span class="n">unknown</span><span class="p">.</span><span class="n">Value</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">}</span><span class="w">   </span><span class="c1">// namespace tinyxml2</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 - 2023 Intel Corporation.
This software and the related documents are Intel copyrighted materials, and your
use of them is governed by the express license under which they were provided to
you (License). Unless the License provides otherwise, you may not use, modify, copy,
publish, distribute, disclose or transmit this software or the related documents
without Intel&#39;s prior written permission.
This software and the related documents are provided as is, with no express or implied
warranties, other than those that are expressly stated in the License..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>